# üê≥ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–±–æ—Ä–∫–µ Docker –æ–±—Ä–∞–∑–∞

## –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **Docker Desktop —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –∑–∞–ø—É—â–µ–Ω**
   - –°–∫–∞—á–∞—Ç—å: https://www.docker.com/products/docker-desktop/
   - –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–º–ø—å—é—Ç–µ—Ä
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Docker Desktop –∑–∞–ø—É—â–µ–Ω (–∏–∫–æ–Ω–∫–∞ –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–º —Ç—Ä–µ–µ)

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ Docker:**
   ```powershell
   docker --version
   docker ps
   ```

## –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**Windows PowerShell:**
```powershell
cd C:\Projects\CivilX\Site\civilx-website\universe\universe
.\build-docker.ps1
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç –Ω–∞–ª–∏—á–∏–µ Docker
- –ü—Ä–æ–≤–µ—Ä–∏—Ç, —á—Ç–æ Docker Desktop –∑–∞–ø—É—â–µ–Ω
- –í–∫–ª—é—á–∏—Ç BuildKit
- –°–æ–±–µ—Ä—ë—Ç –æ–±—Ä–∞–∑ —Å —Ç–µ–≥–∞–º–∏ `civilx-universe:latest` –∏ `civilx-universe:v1.0.0`

### –í–∞—Ä–∏–∞–Ω—Ç 2: –°–æ–±—Ä–∞—Ç—å –≤—Ä—É—á–Ω—É—é

**Windows PowerShell:**
```powershell
cd C:\Projects\CivilX\Site\civilx-website\universe\universe

# –í–∫–ª—é—á–∏—Ç—å BuildKit –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å–±–æ—Ä–∫–∏
$env:DOCKER_BUILDKIT=1
$env:COMPOSE_DOCKER_CLI_BUILD=1

# –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑
docker build -t civilx-universe:latest -t civilx-universe:v1.0.0 .
```

**Linux/Mac:**
```bash
cd /path/to/civilx-website/universe/universe

# –í–∫–ª—é—á–∏—Ç—å BuildKit
export DOCKER_BUILDKIT=1
export COMPOSE_DOCKER_CLI_BUILD=1

# –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑
docker build -t civilx-universe:latest -t civilx-universe:v1.0.0 .
```

## –í—Ä–µ–º—è —Å–±–æ—Ä–∫–∏

- **–ü–µ—Ä–≤–∞—è —Å–±–æ—Ä–∫–∞**: 5-10 –º–∏–Ω—É—Ç (–∑–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞, —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
- **–ü–æ—Å–ª–µ–¥—É—é—â–∏–µ —Å–±–æ—Ä–∫–∏**: 1-3 –º–∏–Ω—É—Ç—ã (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫—ç—à Docker)

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Å–±–æ—Ä–∫–∏:

```powershell
# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤
docker images civilx-universe

# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∏–¥–Ω—ã:
# civilx-universe   latest    <image-id>   <time>   ~200-300MB
# civilx-universe   v1.0.0    <image-id>   <time>   ~200-300MB
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–∞ –ª–æ–∫–∞–ª—å–Ω–æ

–ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–∑:

```powershell
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
docker run -d `
  --name test-universe `
  -p 3001:3001 `
  -e NEXT_PUBLIC_API_URL=https://api.civilx.ru/api/datalab `
  civilx-universe:latest

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker logs -f test-universe

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å health endpoint
curl http://localhost:3001/api/health
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: {"status":"healthy","service":"civilx-universe",...}

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker stop test-universe
docker rm test-universe
```

## –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±—Ä–∞–∑–∞ –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ tar —Ñ–∞–π–ª

```powershell
# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—Ä–∞–∑ –≤ –∞—Ä—Ö–∏–≤
docker save -o civilx-universe-latest.tar civilx-universe:latest

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
Get-Item civilx-universe-latest.tar | Select-Object Name, @{Name="Size(MB)";Expression={[math]::Round($_.Length/1MB,2)}}
```

–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –±—É–¥–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ 200-300 –ú–ë.

### –°–∂–∞—Ç–∏–µ –∞—Ä—Ö–∏–≤–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```powershell
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 7-Zip –∏–ª–∏ –¥—Ä—É–≥–æ–π –∞—Ä—Ö–∏–≤–∞—Ç–æ—Ä
# 7z a -tgzip civilx-universe-latest.tar.gz civilx-universe-latest.tar
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "Docker Desktop –Ω–µ –∑–∞–ø—É—â–µ–Ω"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Docker Desktop –∏–∑ –º–µ–Ω—é –ü—É—Å–∫
2. –î–æ–∂–¥–∏—Ç–µ—Å—å –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ (–∏–∫–æ–Ω–∫–∞ –≤ —Ç—Ä–µ–µ –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç –º–∏–≥–∞—Ç—å)
3. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ —Å–±–æ—Ä–∫—É

### –û—à–∏–±–∫–∞: "request returned 500 Internal Server Error"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Docker Desktop
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø–æ—Ä—Ç–æ–≤
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ

### –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ: "npm ci failed"

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `package-lock.json` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
2. –ï—Å–ª–∏ –Ω–µ—Ç, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ: `npm install`
3. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ —Å–±–æ—Ä–∫—É

### –°–±–æ—Ä–∫–∞ –∑–∞–Ω–∏–º–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

**–†–µ—à–µ–Ω–∏–µ:**
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –ø–µ—Ä–≤–æ–π —Å–±–æ—Ä–∫–∏ (5-10 –º–∏–Ω—É—Ç)
- –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ —Å–±–æ—Ä–∫–∏ –±—É–¥—É—Ç –±—ã—Å—Ç—Ä–µ–µ –±–ª–∞–≥–æ–¥–∞—Ä—è –∫—ç—à—É
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ BuildKit –≤–∫–ª—é—á–µ–Ω: `$env:DOCKER_BUILDKIT=1`

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Å–±–æ—Ä–∫–∏:

1. ‚úÖ –û–±—Ä–∞–∑ —Å–æ–±—Ä–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –¥–µ–ø–ª–æ—é
2. üì¶ –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –æ–±—Ä–∞–∑ –≤ tar —Ñ–∞–π–ª (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä)
3. üöÄ –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤ `DEPLOY_DOCKER.md` –¥–ª—è —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é: `DEPLOY_DOCKER.md`
- –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Å Docker: `DOCKER_QUICK_START.md`
- –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Å–±–æ—Ä–∫–µ: `DOCKER_BUILD.md`


