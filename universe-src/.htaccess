# CivilX.Universe - Apache .htaccess для Next.js Static Export
RewriteEngine On
RewriteBase /

# Разрешить доступ к статическим файлам
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# Разрешить доступ к папкам (для _next и других статических ресурсов)
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Client-side routing для Next.js
# Обработка маршрутов с версиями: /app/datalab/project/{id}/version/{id}/model/{id}/...

# Маршруты модели (data, pivot, reports, checks)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^app/datalab/project/([^/]+)/version/([^/]+)/model/([^/]+)/([^/]+)/?$ app/datalab/project/$1/version/$2/model/$3/$4/index.html [L]

# Страница модели
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^app/datalab/project/([^/]+)/version/([^/]+)/model/([^/]+)/?$ app/datalab/project/$1/version/$2/model/$3/index.html [L]

# Страница версии (список моделей)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^app/datalab/project/([^/]+)/version/([^/]+)/?$ app/datalab/project/$1/version/$2/index.html [L]

# Страница проекта (список версий)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^app/datalab/project/([^/]+)/?$ app/datalab/project/$1/index.html [L]

# Страница загрузки
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^app/datalab/upload/?$ app/datalab/upload/index.html [L]

# Главная страница DataLab
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^app/datalab/?$ app/datalab/index.html [L]

# Главная страница
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ index.html [L]

# Настройки безопасности
<Files "*.log">
    Order deny,allow
    Deny from all
</Files>

<Files "*.sql">
    Order deny,allow
    Deny from all
</Files>

# Настройки кодировки
AddDefaultCharset UTF-8

# Настройки MIME типов
AddType application/json .json
AddType text/html .html
AddType text/css .css
AddType application/javascript .js

# Настройки кэширования для статических файлов
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType application/json "access plus 0 seconds"
</IfModule>

# Gzip сжатие
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE text/javascript
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/json
</IfModule>
